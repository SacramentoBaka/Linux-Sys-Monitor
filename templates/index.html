{% extends "layout.html" %}
{% block title %}Dashboard | Linux Monitor{% endblock %}

{% block content %}

<div class="container">
  <div class="grid">
    <div class="card">
      <h3>ðŸ§  CPU Usage (%)</h3>
      <canvas id="cpuChart"></canvas>
    </div>

    <div class="card">
      <h3>ðŸ’¾ Memory Usage (%)</h3>
      <canvas id="memChart"></canvas>
    </div>

    <div class="card">
      <h3>ðŸ“€ Disk Usage (%)</h3>
      <canvas id="diskChart"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  async function loadData() {
    const res = await fetch('/metrics');
    const data = await res.json();

    const labels = data.map(d => {
      const dt = new Date(d.timestamp);
      return dt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) + " " +
             dt.toLocaleDateString([], { month: 'short', day: 'numeric' });
    });

    const cpu = data.map(d => d.cpu);
    const mem = data.map(d => d.memory);
    const disk = data.map(d => d.disk);

    const makeChart = (id, label, dataset, color) => {
      new Chart(document.getElementById(id).getContext('2d'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: dataset,
            borderColor: color,
            tension: 0.4,
            fill: false,
            pointRadius: 2,
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y}%`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100
            },
            x: {
              ticks: {
                maxTicksLimit: 8,
                autoSkip: true
              }
            }
          }
        }
      });
    };

    makeChart('cpuChart', 'CPU Usage', cpu, '#f56565');
    makeChart('memChart', 'Memory Usage', mem, '#4299e1');
    makeChart('diskChart', 'Disk Usage', disk, '#ecc94b');
  }

  loadData();
</script>

{% endblock %}

